#!/bin/bash

# Install nginx
apt-get update
apt-get install -y nginx

# Start nginx
service nginx start

# Ensure nginx is listening on port 80
sed -i 's/^\(listen\s*80\)/\1 default_server/' /etc/nginx/sites-available/default

# Restart nginx without using systemctl
kill -s HUP $(cat /var/run/nginx.pid)

# Create index.html file with "Hello World!"
echo "Hello World!" > /var/www/html/index.html

# Test nginx response
curl -s http://localhost | grep -q "Hello World!"
if [ $? -ne 0 ]; then
    echo "Nginx is not returning expected response. Check configuration."
    exit 1
fi

# Output success message
echo "Nginx installed and configured successfully."
